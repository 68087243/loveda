
<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <include file="Index:wap_js_css"/>
    <title>名叔堂</title>
    <style>

        /*弹出可拖拽的功能型遮罩层*/
        .maskWrap{position:fixed;z-index:10000;top:0;left:0;width:100%;background:#000;filter:alpha(opacity=00);-moz-opacity:0.00;opacity:0.00}
        .homepop{position:absolute;z-index:10001;min-height:150px;background:#fff;display:none}
        .move{padding-left:15px;border-bottom: 1px solid #E0E0E0; cursor:move;text-align:left;font-size:16px;color:#212121;font-weight:bold;margin-top: 15px;padding-bottom: 12px;}
        .move a{float:right;color:#757575;padding-right:15px;cursor:pointer}
        .move a:hover{color: red}
        .inside{padding:16px;}

        /*遮罩弹出框*/
        .fullbg{position:fixed;z-index:100;left:0;top:0;width:100%;height:100%;background:#000;filter:Alpha(Opacity=60);-moz-opacity:0.6;opacity:0.7}
        .pop{position:fixed;left:5%;width:90%;top:15%;z-index:2001;border:1px solid #666;border-radius:5px;background:#FFF}

        /*自动消失的提示框*/
        #clearpop{position:fixed;left:10%;right:10%;bottom:65%;z-index:999;text-align:center}
        #clearpop p{display:inline-block;min-width:100px;max-width:90%;padding: 10px 20px;font-size:16px;font-weight:bold;line-height:22px;border-radius:4px;background:#333;color:#fff;opacity:0.7}
        @media screen and (max-height:685px){
            #clearpop p{padding:5px 10px;font-size:14px;line-height:18px;opacity:0.7}
        }
    </style>

</head>
<body class="bodyf">

    <form id="formAddPhoto" name="formAddPhoto" class="form-vertical">
        <style>
            .pos-two{ position: relative;top: -71px;left: 113px;}
        </style>

        <div class="container-fluid relative bring-to-z-front">
            <div class="box-padding" >
                <h3 class="clo3" style="padding: 5px 0;">欢迎来到世界最保密的约会服务</h3>
                <p class="give-me-space clo3" style="margin-top: 20px;;">我们尊重您保密的需求，因此我们创建了一些保证您身份秘密的工具。    </p>
                <div class="sample-photo">
                    <div class="image-collage bring-to-z-front tc">
                        <div class="pos-one"><img src="https://static-cdn.ashleymadison.com/n/images/man_medium.png"></div>
                        <div class="pos-two"><img src="https://static-cdn.ashleymadison.com/n/images/man_small.png"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="navbar-fixed-bottom tc">
                <a id="skipPhotoMobile" style="text-decoration: underline;padding: 5px 0" class="clo6 ">跳过此步骤</a>
                <br/>
                <br/>

                <div class="file-overlay control-group full-width go-to-z-top">
                    <label for="photoUploadMobileSkip" onclick="newphotoClip();" class="btn btn-ashley btn-large btn-fullwidth">增加相片</label>
                </div>
        </div>
    </form>

    <div id="skipbox" class="clo3" style="display: none;border-radius: 3px;">

        <h4>您确定不要相片？</h4>
        <br/>
        <p>如果没有相片，您成功的几率大大降低。  </p>
        <p>
            如果有相片，女士联络您的几率提高13倍。
        </p>
        <div style="padding: 15px 0">
            <a id="exitAddPhoto" href="/index/ulist.html" style="text-decoration: underline;padding: 5px 0; font-size: 2em;" class="clo6 ">跳过  </a>
            <label id="uploadPhotoMobile" class="fr btn btn-ashley btn-large btn-fullwidth" onclick="newphotoClip();" for="photoUploadMobileSkip" >增加相片1 </label>

            <div class="clr"></div>
        </div>
        <input id="photoUploadMobileSkip" type="file" accept="image/*" name="photo" class="btn hide btn-file">
    </div>

    <div id="pic"  style="display: none;;">
        <input type="hidden" name="img"/>
        <div class="fullbg" onclick="clearUpfailImg();"></div>
        <div class="pop center" style="width: 500px;left: 50%;margin-left: -250px;">
            <div id="clipArea" style="height: 300px;"></div>
            <p class="tc" id="upnext" style="margin: 5px 0"><a href="javascript:clearUpfailImg();" class="cloc">取消</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0);" id="clipBtn">下一步</a></p>
            <div id="clipArea2" style="display: none;">
                <div class="pic-containaer tc" style="padding: 5px 10px;">
                    <img  alt="" class="blurify" width="300">
                </div>
                <p class="tc">
                    <a href="javascript:mohu(1);">原图</a>
                    <a href="javascript:mohu(2);">模糊1</a>
                    <a href="javascript:mohu(3);">模糊2</a>
                    <a href="javascript:mohu(4);">模糊3</a>
                    <a href="javascript:mohu(5);">模糊4</a>
                    <a href="javascript:mohu(6);">模糊5</a>
                </p>
                <p class="tc"><a href="javascript:clearUpfailImg();" class="cloc">取消</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp<button id="flishbtn"  class="btn btn-primary wide-btn" style="width:25%;margin: 2% 0;">完成</button></p>
            </div>
        </div>
    </div>


    <script type="text/javascript" src="__STATIC__/common/js/hammer.js"></script>
    <script type="text/javascript" src="__STATIC__/common/js/iscroll-zoom.js"></script>
    <script type="text/javascript" src="__STATIC__/common/js/jquery.photoClip.min.js"></script>
    <script type="text/javascript" src="__STATIC__/common/js/blurify.js"></script>
    <script>
        /*阻塞标志，防止重复提交；预设不阻塞*/
        window.subBlock=false;
        $(function(){
            var bodyw = $(window).width()-20;
            $('#skipPhotoMobile').click(function(){
                getMask().maskShow({"tit": "跳过上传相片","width":bodyw, "cont": "#skipbox"});
            })
            $('#pic').css('width',bodyw+'px');

        })

        function newphotoClip(){
            var bodyw = $(window).width()-20;
            $("#clipArea").photoClip({
                width: 250,
                height: 312,
                file: "#photoUploadMobileSkip",
                view: "#view",
                ok: "#clipBtn",
                loadStart: function() {
                    console.log("照片读取中");
                },
                loadComplete: function() {
                    $('#pic .pop.center').css({'width':bodyw+'px','margin-left': -bodyw/2+'px'});
                    $('#pic').show()
                },
                clipFinish: function(dataURL) {
                    $('#clipBtn').attr('onclick',"return false");
                    $('#clipBtn').css('color',"#cccccc");
                    uploadPicByBase64('photo',dataURL);
                }
            });
        }

        function uploadMhImg(scope){
            loading();
            $('#flishbtn').attr('disabled','disabled');
            subBlock =true;
            var dataURL = $('.pic-containaer img').attr('src');
            uploadPicByBase64(scope,dataURL,'flish');
        }

        function mohu($bl){
            new blurify({
                images: document.querySelectorAll('img.blurify'),
                blur: $bl,
                mode: 'auto'
            });
        }

        function uploadPicByBase64(scope,stream,type){
            if(subBlock){
                clearpop('正在截取中');
            }
            subBlock =true;
            var uploadPhp = DOMAIN+'/Public/uploadForKindeditor.php';
            var uploadJson = uploadPhp+"?scope="+scope+"&callback="+DOMAIN+"&isbase64=true&isaj=1";
            $.post(uploadJson,{stream:stream},function(data){
                subBlock =false;
                if(data.code==100){
                    var img = data.data.url.img;
                    var thumb = data.data.url.thumb;
                    if(type == 'flish'){
                        closeLoad();
                        $.post('/home/member/uploadPhoto.html',{ture_img:$('#pic input[name=img]').val(),img:img,scope:scope},function(data){
                            if(data.code == 200){
                                $('#flishbtn').removeAttr('disabled');
                                clearpop(data.message,'','/user/index.html');
                                $('#pic').hide()
                            }else{
                                clearpop(data.message);
                            }
                        })
                    }else{
                        $('.pic-containaer img.blurify').attr('data-src',PUBLIC+img)
                        $('.pic-containaer img').attr('src',PUBLIC+img)
                        $('#pic input[name=img]').val(img);
                        $('#flishbtn').attr('onclick','uploadMhImg("'+scope+'")');
                        $('#clipArea').hide()
                        $('#upnext').hide()
                        $('#clipArea2').show()
                    }
                }else{
                    clearpop('上传失败');
                }
            },'json')
        }
    </script>
</body>
</html>